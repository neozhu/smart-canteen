# Smart-Canteen é¡¹ç›®çŠ¶æ€è®°å½•
**æœ€åæ›´æ–°**: 2025-11-28

## é¡¹ç›®è¿›åº¦æ¦‚è§ˆ âœ…

### å·²å®Œæˆ (100%)

#### 1. é¡¹ç›®ç»“æ„æ­å»º âœ…
- [x] åˆ›å»º `/backend` ç›®å½•
- [x] åˆ›å»º `/frontend` ç›®å½•  
- [x] åˆ›å»º `/infra` ç›®å½•
- [x] åˆ›å»º `/docs` ç›®å½•

#### 2. åç«¯å®ç° (FastAPI) âœ…
- [x] `backend/main.py` - ä¸»æœåŠ¡æ–‡ä»¶
  - CameraManager - USBæ‘„åƒå¤´ç®¡ç†
  - YOLOInference - æ¨ç†å¼•æ“å°è£…
  - ConfigManager - é…ç½®æ–‡ä»¶ç®¡ç†
  - MJPEG è§†é¢‘æµç”Ÿæˆå™¨
  - RESTful API ç«¯ç‚¹
- [x] `backend/requirements.txt` - Pythonä¾èµ–
- [x] `backend/data/classes.json` - å½¢çŠ¶æ ‡ç­¾å®šä¹‰
- [x] `backend/data/price_map.json` - ä»·æ ¼æ˜ å°„é…ç½®
- [x] `backend/data/model_version.json` - OTAå…ƒæ•°æ®

#### 3. å‰ç«¯å®ç° (Next.js 14) âœ…
- [x] Next.js é¡¹ç›®åˆå§‹åŒ–
- [x] `frontend/app/page.tsx` - æ“ä½œå‘˜ä¸»ç•Œé¢
  - å®æ—¶è§†é¢‘æµæ˜¾ç¤º
  - è´­ç‰©è½¦ç®¡ç†
  - Nå¸§ç¨³å®šåŒ–ç®—æ³•
  - ç»“è´¦åŠŸèƒ½
- [x] `frontend/app/customer/page.tsx` - é¡¾å®¢æ˜¾ç¤ºå±
  - åªè¯»è®¢å•å±•ç¤º
  - BroadcastChannel åŒæ­¥
- [x] `frontend/app/layout.tsx` - å¸ƒå±€é…ç½®
- [x] `frontend/next.config.ts` - é™æ€å¯¼å‡ºé…ç½®
- [x] `frontend/.env.local` - ç¯å¢ƒå˜é‡
- [x] ä¾èµ–å®‰è£…: swr, axios

#### 4. é…ç½®ç³»ç»Ÿ âœ…
- [x] å½¢çŠ¶æ ‡ç­¾ä½“ç³»è®¾è®¡ (plate/bowl/tray + size)
- [x] ä»·æ ¼æ˜ å°„ JSON ç»“æ„
- [x] é…ç½®ä¸€è‡´æ€§éªŒè¯é€»è¾‘

#### 5. æ„å»ºå·¥å…· âœ…
- [x] `infra/build.py` - è‡ªåŠ¨åŒ–æ‰“åŒ…è„šæœ¬
- [x] `infra/requirements-build.txt` - æ„å»ºä¾èµ–
- [x] PyInstaller é…ç½®

#### 6. æ–‡æ¡£ âœ…
- [x] `README.md` - é¡¹ç›®æ¦‚è§ˆ
- [x] `docs/DEVELOPMENT.md` - å¼€å‘æŒ‡å—
- [x] `.gitignore` - Git å¿½ç•¥é…ç½®

---

## å½“å‰ç³»ç»ŸçŠ¶æ€

### å¯è¿è¡ŒçŠ¶æ€
âœ… **åç«¯**: å¯ä»¥ç‹¬ç«‹å¯åŠ¨ï¼Œä½†å¤„äºæ¨¡æ‹Ÿæ¨¡å¼ï¼ˆæ— çœŸå®YOLOæ¨¡å‹ï¼‰
âœ… **å‰ç«¯**: å®Œæ•´åŠŸèƒ½å®ç°ï¼Œå¯è¿æ¥åç«¯API
âš ï¸ **æ¨ç†**: éœ€è¦æ”¾ç½® `backend/models/best.onnx` æ‰èƒ½è¿›è¡ŒçœŸå®æ£€æµ‹

### å·²å®‰è£…ä¾èµ–
- **åç«¯**: æœªå®‰è£…ï¼ˆéœ€è¦è¿è¡Œ `pip install -r requirements.txt`ï¼‰
- **å‰ç«¯**: âœ… å·²å®‰è£…ï¼ˆnode_modules å­˜åœ¨ï¼ŒåŒ…æ‹¬ swr, axiosï¼‰

---

## ä¸‹æ¬¡å¯åŠ¨æ­¥éª¤

### å¿«é€ŸéªŒè¯è¿è¡Œ

```bash
# ç»ˆç«¯1 - å¯åŠ¨åç«¯
cd d:\github\smart-canteen\backend
python -m venv venv
venv\Scripts\activate
pip install -r requirements.txt
python main.py

# ç»ˆç«¯2 - å¯åŠ¨å‰ç«¯
cd d:\github\smart-canteen\frontend
npm run dev
```

è®¿é—®:
- æ“ä½œå‘˜ç•Œé¢: http://localhost:3000
- é¡¾å®¢å±å¹•: http://localhost:3000/customer
- APIæ–‡æ¡£: http://localhost:8000/docs

---

## å¾…å®ç°åŠŸèƒ½ï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰

### ğŸ”´ é«˜ä¼˜å…ˆçº§

#### 1. âœ… æ•°æ®æ ‡æ³¨ä¸æ¨¡å‹è®­ç»ƒç³»ç»Ÿï¼ˆå·²å®Œæˆï¼‰
**ä½ç½®**: 
- `frontend/app/annotate/page.tsx` - æ ‡æ³¨ç•Œé¢
- `backend/annotation.py` - æ ‡æ³¨å’Œè®­ç»ƒé€»è¾‘

**åŠŸèƒ½**:
- âœ… å¯è§†åŒ–æ•°æ®é‡‡é›†ç•Œé¢
- âœ… è‡ªåŠ¨ç”Ÿæˆ YOLO æ ¼å¼æ ‡æ³¨
- âœ… æ ·æœ¬ç»Ÿè®¡å’Œç®¡ç†
- âœ… åå°æ¨¡å‹è®­ç»ƒ
- âœ… å®æ—¶è®­ç»ƒè¿›åº¦è¿½è¸ª
- âœ… è‡ªåŠ¨å¯¼å‡º ONNX æ¨¡å‹

**ä½¿ç”¨æ–¹æ³•**: 
- è®¿é—® `/annotate` é¡µé¢
- å‚è€ƒæ–‡æ¡£: `docs/ANNOTATION_GUIDE.md`

**ä¸‹ä¸€æ­¥**: 
- [ ] é‡‡é›†çœŸå®æ•°æ®ï¼ˆæ¯ç±» 20+ å¼ ï¼‰
- [ ] æ‰§è¡Œé¦–æ¬¡è®­ç»ƒ
- [ ] éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

#### 2. å®Œå–„ OTA æ›´æ–°é€»è¾‘
**ä½ç½®**: `backend/main.py` - `ConfigManager` ç±»
**ä»»åŠ¡**:
- [ ] å®ç° `check_for_updates()` æ–¹æ³•
- [ ] ä¸‹è½½æ¨¡å‹æ–‡ä»¶
- [ ] SHA256 æ ¡éªŒ
- [ ] éªŒè¯ classes.json ä¸€è‡´æ€§
- [ ] åŸå­æ›¿æ¢ + å›æ»šæœºåˆ¶

**å»ºè®®æ–°å¢**:
```python
# backend/ota.py
class OTAManager:
    async def check_updates(self):
        """æ£€æŸ¥è¿œç¨‹æ›´æ–°"""
        pass
    
    async def download_model(self, url: str, sha256: str):
        """ä¸‹è½½å¹¶éªŒè¯æ¨¡å‹"""
        pass
    
    def rollback(self):
        """å›æ»šåˆ°ä¸Šä¸€ç‰ˆæœ¬"""
        pass
```

### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§

#### 3. å‰ç«¯ç¨³å®šåŒ–é€»è¾‘ä¼˜åŒ–
**ä½ç½®**: `frontend/app/page.tsx`, line 64-82
**é—®é¢˜**: å½“å‰ç¨³å®šåŒ–é€»è¾‘å¯èƒ½åœ¨å¿«é€Ÿç§»é™¤ç‰©ä½“æ—¶è¯¯è§¦å‘
**æ”¹è¿›**:
- [ ] æ·»åŠ "æ¶ˆå¤±ç¨³å®šåŒ–"ï¼ˆç‰©ä½“æ¶ˆå¤±ä¹Ÿéœ€è¦Nå¸§ç¡®è®¤ï¼‰
- [ ] é˜²æŠ–é€»è¾‘é¿å…é‡å¤æ·»åŠ 
- [ ] å¯é…ç½®çš„ç¨³å®šåŒ–é˜ˆå€¼

#### 4. æ·»åŠ ç®¡ç†ç•Œé¢
**å»ºè®®è·¯å¾„**: `frontend/app/admin/page.tsx`
**åŠŸèƒ½**:
- [ ] å®æ—¶æŸ¥çœ‹æ£€æµ‹ç»Ÿè®¡
- [ ] ä¿®æ”¹ price_map.json
- [ ] æŸ¥çœ‹è®¢å•å†å²
- [ ] ç³»ç»Ÿå¥åº·ç›‘æ§

#### 5. é”™è¯¯å¤„ç†å¢å¼º
**ä½ç½®**: å…¨å±€
**ä»»åŠ¡**:
- [ ] åç«¯: ç»Ÿä¸€å¼‚å¸¸å¤„ç†ä¸­é—´ä»¶
- [ ] å‰ç«¯: é”™è¯¯è¾¹ç•Œ (Error Boundary)
- [ ] æ‘„åƒå¤´æ–­å¼€é‡è¿é€»è¾‘
- [ ] ç½‘ç»œæ–­çº¿æ—¶çš„ UI æç¤º

### ğŸŸ¢ ä½ä¼˜å…ˆçº§

#### 6. æ€§èƒ½ä¼˜åŒ–
- [ ] é›†æˆ OpenVINO (Intelç¡¬ä»¶åŠ é€Ÿ)
- [ ] è°ƒæ•´ MJPEG ç¼–ç è´¨é‡
- [ ] å‰ç«¯è½®è¯¢é¢‘ç‡è‡ªé€‚åº”
- [ ] æ·»åŠ æ€§èƒ½ç›‘æ§æŒ‡æ ‡

#### 7. æµ‹è¯•è¦†ç›–
- [ ] åç«¯å•å…ƒæµ‹è¯• (pytest)
- [ ] API é›†æˆæµ‹è¯•
- [ ] å‰ç«¯ç»„ä»¶æµ‹è¯• (Jest + React Testing Library)
- [ ] E2E æµ‹è¯• (Playwright)

#### 8. ç”Ÿäº§éƒ¨ç½²ä¼˜åŒ–
- [ ] Docker å®¹å™¨åŒ–
- [ ] Windows æœåŠ¡è‡ªåŠ¨é‡å¯
- [ ] æ—¥å¿—è½®è½¬
- [ ] ç›‘æ§å‘Šè­¦é›†æˆ

---

## æœ€æ–°åŠŸèƒ½ ğŸ†•

### æ ‡æ³¨ä¸è®­ç»ƒç³»ç»Ÿ (2025-11-30 æ–°å¢)

**æ–°å¢é¡µé¢**: `/annotate` - æ•°æ®æ ‡æ³¨ä¸æ¨¡å‹è®­ç»ƒ

**å·¥ä½œæµç¨‹**:
```
ğŸ“¸ å®æ—¶æ‹ç…§ â†’ ğŸ·ï¸ è‡ªåŠ¨æ ‡æ³¨ â†’ ğŸ“Š ç»Ÿè®¡æŸ¥çœ‹ â†’ ğŸš€ ä¸€é”®è®­ç»ƒ â†’ ğŸ“¦ è‡ªåŠ¨éƒ¨ç½²
```

**æ ¸å¿ƒç‰¹æ€§**:
- æ— éœ€æ‰‹åŠ¨ç»˜åˆ¶è¾¹ç•Œæ¡†ï¼ˆå…¨ç”»é¢æ ‡æ³¨ï¼‰
- å®æ—¶æ ·æœ¬ç»Ÿè®¡å’Œè¿›åº¦æ¡
- åå°è®­ç»ƒï¼Œä¸é˜»å¡ç•Œé¢
- è®­ç»ƒå®Œæˆè‡ªåŠ¨å¯¼å‡º ONNX
- æ”¯æŒæ ·æœ¬åˆ é™¤å’Œé‡æ–°é‡‡é›†

**å¿«é€Ÿå¼€å§‹**:
1. è¿›å…¥æ ‡æ³¨é¡µé¢: http://localhost:3000/annotate
2. æ”¾ç½®ç‰©å“ â†’ é€‰æ‹©æ ‡ç­¾ â†’ ç‚¹å‡»æ‹ç…§
3. é‡‡é›† 20+ å¼ /ç±» â†’ ç‚¹å‡»"å¼€å§‹è®­ç»ƒ"
4. ç­‰å¾… 5-30 åˆ†é’Ÿ â†’ è‡ªåŠ¨éƒ¨ç½²æ–°æ¨¡å‹

è¯¦ç»†æ–‡æ¡£: [ANNOTATION_GUIDE.md](docs/ANNOTATION_GUIDE.md)

---

## å·²çŸ¥é—®é¢˜ / æ³¨æ„äº‹é¡¹

### âš ï¸ é™åˆ¶
1. **æ— æ‘„åƒå¤´æ—¶**: åç«¯ä¼šæ˜¾ç¤º"Camera Offline"å¹¶ç»§ç»­è¿è¡Œ
2. **æ— æ¨¡å‹æ—¶**: ä¸ä¼šæ‰§è¡Œæ¨ç†ï¼Œ`latest_detection` å§‹ç»ˆä¸ºç©ºï¼ˆéœ€å…ˆæ ‡æ³¨+è®­ç»ƒï¼‰
3. **BroadcastChannel**: ä»…æ”¯æŒåŒæºç­–ç•¥ï¼ŒåŒå±å¿…é¡»æ¥è‡ªåŒä¸€åŸŸå
4. **è®­ç»ƒæ—¶é—´**: CPU è®­ç»ƒè¾ƒæ…¢ï¼Œå»ºè®®ä½¿ç”¨ GPUï¼ˆéœ€å®‰è£… CUDA ç‰ˆ PyTorchï¼‰

### ğŸ› æ½œåœ¨ Bug
1. **ç¨³å®šåŒ–é€»è¾‘**: `useEffect` ä¾èµ–å¯èƒ½å¯¼è‡´é—­åŒ…é—®é¢˜ï¼ˆ`addToCart` ä½¿ç”¨äº†æ—§çš„ `priceMap`ï¼‰
2. **è§†é¢‘æµå†…å­˜**: é•¿æ—¶é—´è¿è¡Œå¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼ï¼ˆéœ€éªŒè¯ï¼‰
3. **CORS**: ç”Ÿäº§ç¯å¢ƒéœ€è¦é™åˆ¶ `allow_origins`

### ğŸ’¡ æ”¹è¿›å»ºè®®
1. å°† `stabilizationBuffer` ç§»åˆ° React Context æˆ– Zustand
2. æ·»åŠ æ‘„åƒå¤´é¢„è§ˆåˆ†è¾¨ç‡é€‰æ‹©
3. æ”¯æŒå¤šæ‘„åƒå¤´åˆ‡æ¢
4. è®¢å•å¯¼å‡ºä¸º CSV/Excel

---

## é…ç½®æ–‡ä»¶è¯´æ˜

### `backend/data/classes.json`
å®šä¹‰æ£€æµ‹çš„å½¢çŠ¶ç±»åˆ«ï¼ˆä¸ YOLO æ¨¡å‹åŒ¹é…ï¼‰
```json
[
  "plate_round_small",   // ç´¢å¼•0
  "plate_round_large",   // ç´¢å¼•1
  "bowl_round_small",    // ç´¢å¼•2
  ...
]
```

### `backend/data/price_map.json`
ä¸šåŠ¡æ˜ å°„ï¼ˆUI å±‚ä½¿ç”¨ï¼‰
```json
{
  "plate_round_large": {
    "name": "å¤§ç›˜",      // æ˜¾ç¤ºåç§°
    "price": 15.0,       // ä»·æ ¼
    "enabled": true      // æ˜¯å¦å¯ç”¨
  }
}
```

**ä¸€è‡´æ€§è§„åˆ™**: 
- `price_map` çš„æ¯ä¸ª key å¿…é¡»å­˜åœ¨äº `classes.json`
- å¯åŠ¨æ—¶åç«¯ä¼šè‡ªåŠ¨éªŒè¯å¹¶æ‰“å°è­¦å‘Š

---

## ç›¸å…³èµ„æº

- **é¡¹ç›®å®ªç« **: `.specify/memory/constitution.md`
- **å¼€å‘æŒ‡å—**: `docs/DEVELOPMENT.md`
- **API æ–‡æ¡£**: http://localhost:8000/docs (å¯åŠ¨åè‡ªåŠ¨ç”Ÿæˆ)

---

## Git æäº¤å»ºè®®

å½“å‰æ‰€æœ‰æ–‡ä»¶æœªæäº¤ï¼Œå»ºè®®ï¼š

```bash
git add .
git commit -m "feat: initial Smart-Canteen implementation

- Backend: FastAPI + Camera + YOLO wrapper
- Frontend: Next.js 14 with operator/customer screens
- Config: Shape-based detection system
- Infra: Build scripts and documentation
"
```

---

## è”ç³»ä¸åä½œ

**æ¶æ„å†³ç­–**: å‚è€ƒ `constitution.md`
**é—®é¢˜åé¦ˆ**: åœ¨ä»£ç ä¸­æœç´¢ `TODO` å’Œ `FIXME`
**è´¡çŒ®æŒ‡å—**: æ‰€æœ‰æ–°åŠŸèƒ½éœ€å…ˆå†™ spec

---

_æ­¤æ–‡ä»¶è‡ªåŠ¨ç”Ÿæˆï¼Œè®°å½•é¡¹ç›®å½“å‰çŠ¶æ€_
